<div class="container mx-auto px-4 py-8">
  <div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-900 mb-2">Weekly High Score Basketball</h1>
    <p class="text-gray-600">2023-24 NBA Season - Fantasy Draft Analysis</p>
    <p class="text-sm text-gray-500 mt-2">Scoring: Points + Rebounds + (2 × Assists) + (3 × Blocks) + (3 × Steals)</p>
  </div>

  <div class="bg-gradient-to-r from-blue-50 to-blue-100 border-l-4 border-blue-600 rounded-lg p-5 mb-6 shadow-sm">
    <div class="flex flex-col md:flex-row md:items-start md:justify-between gap-6">
      <div class="flex-1">
        <h3 class="text-sm font-bold text-blue-900 mb-3 uppercase tracking-wide">How to Use This Table:</h3>
        <ul class="text-sm text-blue-900 space-y-2">
          <li><strong class="font-extrabold">Draft Targets:</strong> Look for HIGH Variance (green badge) + High Upside (10+)</li>
          <li><strong class="font-extrabold">Variance:</strong> Boom/bust potential. Green = explosive games (ideal for weekly format)</li>
          <li><strong class="font-extrabold">Upside:</strong> Gap between weekly high and average score. Higher = more draft value</li>
          <li><strong class="font-extrabold">Click column headers</strong> to sort. Click player names for weekly breakdown.</li>
        </ul>
      </div>
      <div class="md:w-72">
        <div class="bg-white rounded-lg p-4 border-2 border-blue-300 shadow-md">
          <h4 class="text-xs font-bold text-blue-900 mb-3 uppercase tracking-wider">Quick Sort</h4>
          <div class="space-y-2">
            <button onclick="document.querySelector('[data-column=variance]').click()" class="w-full px-4 py-2.5 text-sm font-bold text-white bg-green-600 hover:bg-green-700 rounded-md shadow-sm hover:shadow transition-all">
              Sort by Variance
            </button>
            <button onclick="document.querySelector('[data-column=differential]').click()" class="w-full px-4 py-2.5 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 rounded-md shadow-sm hover:shadow transition-all">
              Sort by Upside
            </button>
            <button onclick="document.querySelector('[data-column=peak]').click()" class="w-full px-4 py-2.5 text-sm font-bold text-white bg-purple-600 hover:bg-purple-700 rounded-md shadow-sm hover:shadow transition-all">
              Sort by Peak
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Mobile scroll hint -->
  <div class="md:hidden mb-2 text-center text-xs text-gray-500 italic">
    Swipe left/right to see all columns →
  </div>

  <div class="bg-white rounded-lg shadow-lg overflow-hidden">
    <div class="overflow-x-auto">
      <table class="min-w-full" data-controller="sortable-table">
        <thead>
          <!-- Column group labels -->
          <tr class="border-b-2 border-gray-300">
            <th colspan="3" class="px-5 py-3 text-xs font-bold text-gray-700 uppercase tracking-wider text-left bg-gray-100">Player Info</th>
            <th colspan="4" class="px-5 py-3 text-xs font-bold text-blue-800 uppercase tracking-wider text-center bg-blue-100 border-l-4 border-blue-300">Draft Value Metrics</th>
            <th colspan="4" class="px-5 py-3 text-xs font-bold text-gray-700 uppercase tracking-wider text-center bg-gray-100 border-l-4 border-gray-300">Context Stats</th>
          </tr>
          <tr class="bg-gray-50 border-b border-gray-300">
            <!-- Player Info -->
            <th scope="col" class="sticky left-0 z-10 bg-gray-50 px-3 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors" data-action="click->sortable-table#sort" data-column="rank">
              #
            </th>
            <th scope="col" class="px-5 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors" data-action="click->sortable-table#sort" data-column="player">
              Player Name
            </th>
            <th scope="col" class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors" data-action="click->sortable-table#sort" data-column="team">
              Team
            </th>

            <!-- Draft Value Metrics (most important) -->
            <th scope="col" class="px-5 py-3 text-center text-xs font-bold text-blue-700 uppercase tracking-wide cursor-pointer hover:bg-blue-100 transition-colors border-l-4 border-blue-300" data-action="click->sortable-table#sort" data-column="variance" title="Boom/bust potential - higher is better for weekly format">
              Variance ⓘ
            </th>
            <th scope="col" class="px-5 py-3 text-center text-xs font-bold text-blue-700 uppercase tracking-wide cursor-pointer hover:bg-blue-100 transition-colors" data-action="click->sortable-table#sort" data-column="differential" title="Gap between weekly high and average score">
              Upside ⓘ
            </th>
            <th scope="col" class="px-5 py-3 text-center text-xs font-bold text-blue-700 uppercase tracking-wide cursor-pointer hover:bg-blue-100 transition-colors" data-action="click->sortable-table#sort" data-column="avg_high" title="Average of best weekly scores">
              Avg High
            </th>
            <th scope="col" class="px-5 py-3 text-center text-xs font-bold text-blue-700 uppercase tracking-wide cursor-pointer hover:bg-blue-100 transition-colors" data-action="click->sortable-table#sort" data-column="peak" title="Best single week performance">
              Peak
            </th>

            <!-- Context Stats (secondary) -->
            <th scope="col" class="px-5 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors border-l-4 border-gray-300" data-action="click->sortable-table#sort" data-column="avg_score" title="Season average per game">
              Avg/Game
            </th>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors" data-action="click->sortable-table#sort" data-column="weeks" title="Weeks with games played">
              Weeks
            </th>
            <th scope="col" class="px-4 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors" data-action="click->sortable-table#sort" data-column="games_played">
              GP
            </th>
            <th scope="col" class="px-5 py-3 text-center text-xs font-semibold text-gray-600 uppercase tracking-wide cursor-pointer hover:bg-gray-200 transition-colors" data-action="click->sortable-table#sort" data-column="floor" title="Worst weekly score">
              Floor
            </th>
          </tr>
        </thead>
        <tbody class="bg-white" data-sortable-table-target="tbody">
          <% @players.each_with_index do |player, index| %>
            <% summary = player.player_summary %>
            <% row_bg = index.even? ? 'bg-white' : 'bg-gray-50' %>
            <tr class="<%= row_bg %> hover:bg-blue-50 cursor-pointer transition-colors border-b border-gray-200" onclick="window.location='<%= player_path(player) %>'">
              <!-- Player Info -->
              <td class="sticky left-0 z-10 <%= row_bg %> hover:bg-blue-50 px-3 py-3 whitespace-nowrap text-sm font-medium text-gray-600" data-value="<%= index + 1 %>">
                <%= index + 1 %>
              </td>
              <td class="px-5 py-3 whitespace-nowrap" data-value="<%= player.name %>" onclick="event.stopPropagation()">
                <%= link_to player.name, player_path(player), class: "text-blue-600 hover:text-blue-800 hover:underline font-bold text-sm" %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-xs font-semibold text-gray-500 uppercase tracking-wide" data-value="<%= player.team %>">
                <%= player.team %>
              </td>

              <!-- Draft Value Metrics -->
              <td class="px-5 py-3 whitespace-nowrap text-center border-l-4 border-blue-200" data-value="<%= summary.variance.round(1) %>">
                <% variance_level = variance_class(summary.variance) %>
                <div class="flex flex-col items-center">
                  <span class="px-3 py-1.5 inline-flex text-base leading-none font-bold rounded-md <%= variance_level[:class] %> shadow-sm">
                    <%= summary.variance.round(1) %>
                  </span>
                  <span class="mt-1 text-xs font-semibold text-gray-500"><%= variance_level[:label] %></span>
                </div>
              </td>
              <td class="px-5 py-3 whitespace-nowrap text-center" data-value="<%= summary.differential&.round(1) || 0 %>">
                <% if summary.differential %>
                  <% diff_color = summary.differential >= 10 ? 'text-green-600' : summary.differential >= 5 ? 'text-blue-600' : 'text-gray-500' %>
                  <span class="<%= diff_color %> text-xl font-extrabold">
                    +<%= summary.differential.round(1) %>
                  </span>
                <% else %>
                  <span class="text-gray-400 text-sm">-</span>
                <% end %>
              </td>
              <td class="px-5 py-3 whitespace-nowrap text-center text-base text-gray-900 font-bold" data-value="<%= summary.avg_weekly_high.round(1) %>">
                <%= summary.avg_weekly_high.round(1) %>
              </td>
              <td class="px-5 py-3 whitespace-nowrap text-center" data-value="<%= summary.peak_score %>">
                <span class="text-green-600 font-black text-xl">
                  <%= summary.peak_score %>
                </span>
              </td>

              <!-- Context Stats -->
              <td class="px-5 py-3 whitespace-nowrap text-center text-sm text-gray-600 border-l-4 border-gray-200" data-value="<%= summary.avg_score&.round(1) || 0 %>">
                <%= summary.avg_score&.round(1) || '-' %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600" data-value="<%= summary.non_zero_weeks %>">
                <%= summary.non_zero_weeks %>
              </td>
              <td class="px-4 py-3 whitespace-nowrap text-center text-sm text-gray-600" data-value="<%= summary.games_played || 0 %>">
                <%= summary.games_played || '-' %>
              </td>
              <td class="px-5 py-3 whitespace-nowrap text-center" data-value="<%= summary.floor_score %>">
                <span class="text-red-600 font-bold text-base">
                  <%= summary.floor_score %>
                </span>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-8 bg-gradient-to-r from-green-50 to-emerald-50 border-l-4 border-green-600 rounded-lg p-5 shadow-sm">
    <h3 class="text-sm font-bold text-green-900 mb-4 uppercase tracking-wide">Quick Reference:</h3>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-sm">
      <div class="bg-white rounded-lg p-4 border border-green-200 shadow-sm">
        <div class="flex items-center mb-2">
          <span class="text-2xl mr-2">🎯</span>
          <strong class="text-green-900 font-bold">Top Targets</strong>
        </div>
        <p class="text-green-800">Variance 150+ (green) + Upside 10+</p>
      </div>
      <div class="bg-white rounded-lg p-4 border border-green-200 shadow-sm">
        <div class="flex items-center mb-2">
          <span class="text-2xl mr-2">✅</span>
          <strong class="text-green-900 font-bold">Solid Picks</strong>
        </div>
        <p class="text-green-800">Variance 80-150 (yellow) + Upside 5+</p>
      </div>
      <div class="bg-white rounded-lg p-4 border border-green-200 shadow-sm">
        <div class="flex items-center mb-2">
          <span class="text-2xl mr-2">📊</span>
          <strong class="text-green-900 font-bold">Availability</strong>
        </div>
        <p class="text-green-800">Look for 20+ weeks played</p>
      </div>
    </div>
  </div>
</div>
